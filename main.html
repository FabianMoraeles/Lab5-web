<html>
<head></head>
<body>
<script type="application/javascript">
  const mensajes = [];
  const API_URL = "https://chat.nrywhite.lat/chats";

  // Crear contenedor principal
  const app = document.createElement("div");
  app.style.height = "100vh";
  app.style.display = "flex";
  app.style.flexDirection = "column";
  app.style.justifyContent = "space-between";
  app.style.fontFamily = "sans-serif";

  // Crear área de mensajes
  const listaMensajes = document.createElement("div");
  listaMensajes.style.flex = "1";
  listaMensajes.style.overflowY = "auto";
  listaMensajes.style.padding = "10px";

  // Crear barra de entrada
  const inputBar = document.createElement("div");
  inputBar.style.display = "flex";
  inputBar.style.borderTop = "1px solid #ccc";
  inputBar.style.padding = "10px";
  inputBar.style.background = "#f5f5f5";

  // Campo de texto
  const input = document.createElement("input");
  input.type = "text";
  input.placeholder = "Escribe tu mensaje...";
  input.maxLength = 140;
  input.style.flex = "1";
  input.style.padding = "10px";
  input.style.fontSize = "16px";

  // Botón enviar
  const boton = document.createElement("button");
  boton.innerText = "Enviar";
  boton.style.marginLeft = "10px";
  boton.style.padding = "10px 15px";
  boton.style.fontSize = "16px";
  boton.style.cursor = "pointer";

// Función para enviar mensaje
async function enviarMensaje() {
  const texto = input.value.trim();
  if (texto === "") return;

  const username = "JostOficial"; // tu usuario fijo

  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: username,
      message: texto
    }),
  });

  input.value = "";
  obtenerMensajes();
}



  // Permitir enviar con Enter
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") enviarMensaje();
  });

  // Evento del botón
  boton.addEventListener("click", enviarMensaje);

  // Función para obtener y mostrar mensajes
  const Actualizado = true;
  async function obtenerMensajes() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      listaMensajes.innerHTML = "";
      data.forEach(({ message }) => {
        const item = document.createElement("div");
        item.innerText = message;
        item.style.padding = "5px 0";
        listaMensajes.appendChild(item);
      });
      // Scroll al final
      //listaMensajes.scrollTop = listaMensajes.scrollHeight;
      if(Actualizado) {
        listaMensajes.scrollTop = listaMensajes.scrollHeight;
        Actualizado = false;
      }
    } catch (err) {
      console.error("Error al obtener mensajes", err);
    }
  }

  // Refrescar cada 5 segundos
  setInterval(obtenerMensajes, 5000);
  obtenerMensajes();

  // Armar la interfaz
  inputBar.appendChild(input);
  inputBar.appendChild(boton);
  app.appendChild(listaMensajes);
  app.appendChild(inputBar);
  document.body.appendChild(app);
</script>
</body>
</html>